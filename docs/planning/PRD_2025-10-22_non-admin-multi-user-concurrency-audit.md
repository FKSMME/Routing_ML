# PRD - Non-Admin Multi-User Concurrency Audit (2025-10-22)

## Executive Summary
- 비관리자 5명이 모든 화면에 동시에 접속했을 때 발생 가능한 동시성/경합 문제를 전수 조사하고 영향 범위를 정량 지표로 정리한다.
- 백엔드, 프론트엔드, 공용 패키지, 배포 스크립트, 운영 문서까지 전체 리포지토리를 대상으로 한다.
- 발견된 취약 구간에 대한 위험도, 재현 조건, 개선 우선순위를 정의하고 대응 로드맵을 제시한다.

## Problem Statement
현행 시스템은 단일 사용자 중심으로 설계된 코드가 다수 존재하여, 5명의 비관리자 사용자가 모든 주요 페이지에서 동시에 작업할 경우 다음과 같은 문제가 우려된다.
1. **세션/토큰 경합**: 토큰 재발급, 갱신 타이밍이 겹칠 때 덮어쓰기 또는 로그아웃 발생 가능성.
2. **공유 자원 동시 수정**: 전역 캐시, 임시 파일, 큐, 스케줄러가 레이스 컨디션에 노출될 수 있음.
3. **DB 잠금 & 트랜잭션 경합**: 동일 레코드 갱신 시 팬텀 업데이트, 데드락, 낙관적 잠금 실패 가능성.
4. **프론트엔드 상태 오염**: 싱글톤 스토어, WebSocket 구독이 사용자별로 격리되지 않을 수 있음.
5. **문서화 미비**: 동시 사용자 시나리오에 대한 운영 가이드가 부족하여 대응이 지연될 위험.

## Goals and Objectives
1. **전체 리포지토리 동시성 위험 식별** - 코드, 설정, 문서를 포함한 경합 리스크 전부 목록화.
2. **사용자 흐름 단위 정량 평가** - 페이지/기능별 동시 접속 시 실패 확률, 처리량 한계, 우선순위 산출.
3. **위험 완화안 및 백로그 정의** - 단기 패치, 중기 구조 개선, 장기 리팩토링 로드맵 제안.
4. **운영/QA 절차 강화** - 재현 스크립트, 모니터링 지표, 경고 체계 제안.

## Requirements

### Functional Requirements
1. **FR-1 전수 감사 범위 정의**
   - 백엔드 API, 비동기 작업, 데이터베이스 스키마, 캐시/큐 구성, 배포 스크립트 포함.
   - 프론트엔드 3개 앱(frontend-home, prediction, training) 및 shared 모듈 포함.
   - 공용 설정(config, scripts, monitoring)과 문서화(deliverables, docs) 검토.
2. **FR-2 동시성 위험 탐지**
   - 전역 상태, 싱글톤 패턴, 동기화 없는 공유 자원 사용처 식별.
   - DB 트랜잭션 격리 수준, 잠금 전략, 재시도 로직 분석.
   - API 레이트 리밋, 토큰 관리, 세션 저장소 확인.
3. **FR-3 정량 지표 산출**
   - 페이지/기능별 동시 접속 5명 기준 예상 응답 시간, 실패 케이스 비율, 병목 리소스.
   - 코드 메트릭(공유 상태 사용 횟수, 비원자 파일 작업 수 등) 계량.
   - 위험도 점수(영향도 × 발생 가능성)와 개선 난이도 산정.
4. **FR-4 보고서 작성**
   - 문제 요약, 증상, 근거 코드 경로, 재현 절차, 로그/메트릭 제시.
   - 위험 구간 우선순위표, 개선 가이드, 필요한 도구/테스트 케이스 제안.
   - 한글 보고서, 표/그래프 포함, 각 위험 항목에 정량 수치 명시.

### Non-Functional Requirements
- **NFR-1 정확성**: 모든 위험 항목은 코드 근거 경로와 분석 근거를 포함해야 한다.
- **NFR-2 추적성**: 발견-재현-개선 항목이 README/운영 문서와 연결되어야 한다.
- **NFR-3 재현성**: 최소 5명 동시 접속 시나리오를 재현할 수 있는 스크립트/테스트 제안.
- **NFR-4 보고 체계**: 최종 보고서는 감사 레포트 형식(요약, 세부, 결론, 부록)을 따른다.

## Phase Breakdown

### Phase 1 - 감사 범위 정립 및 시나리오 모델링 (Est. 6h)
**Objective**: 동시 접속 시나리오 정의, 조사 범위 확정, 분석 프레임 수립.

**Tasks**:
1. 사용자 여정, 페이지 목록, API 호출 플로우 정리.
2. 시스템 구성도, 트래픽 경로, 상태 저장소 인벤토리 작성.
3. 위험 평가 메트릭(영향도, 발생도, 탐지 가능도) 정의.
4. 정량 지표 수집 방법(로그, 코드 스캔, 테스트) 설계.
5. 감사 샘플링 기준 및 우선순위 확정.

**Acceptance Criteria**:
- 전체 기능/페이지 목록과 책임 시스템 매핑 완료.
- 평가 지표와 점수화 방식 합의.
- 감사 체크리스트 초안 확정.
- 시나리오 다이어그램/표 초안 준비.

### Phase 2 - 코드 및 문서 정밀 감사 (Est. 16h)
**Objective**: 백엔드, 프론트엔드, 문서 전 영역에서 동시성 위험 탐지 및 증거 수집.

**Tasks**:
1. 백엔드 서비스별(예: `backend/`, `common/`) 전역 상태, 공유 리소스 검사.
2. 프론트엔드 앱별 스토어(Zustand, Redux 등) 및 API 병행 호출 처리 조사.
3. 데이터베이스 마이그레이션, 스키마, 저장 프로시저 락 전략 검토.
4. 배치/파이프라인 스크립트의 병렬 실행 시나리오 점검.
5. 문서/운영 가이드의 동시 사용자 지침 여부 확인.
6. 발견 항목별 코드 스니펫, 로그 증적, 위험 점수 산정.

**Acceptance Criteria**:
- 위험 항목 목록(코드 경로, 설명, 정량 지표, 우선순위) 완성.
- 증적 자료(코드 참조, 로그/메트릭) 각 항목에 첨부.
- 누락 영역 재검토 완료.
- 필요 시 추가 실험/테스트 계획 수립.

### Phase 3 - 검증, 시뮬레이션, 보고서 작성 (Est. 10h)
**Objective**: 통합 위험 평가, 시뮬레이션 결과 검증, 최종 보고서 작성 및 리뷰.

**Tasks**:
1. 시뮬레이션/부하 테스트(가능 범위 내) 수행 및 결과 정량화.
2. 위험도 매트릭스, 개선 로드맵, 우선순위표 작성.
3. 운영/QA 대응 프로세스, 모니터링 지표 제안.
4. 보고서 본문, 요약, 부록(데이터 테이블, 시나리오) 작성.
5. 이해관계자 리뷰 반영 및 최종본 확정.

**Acceptance Criteria**:
- 동시 접속 5명 시나리오 정량 지표 제시.
- 위험도/완화안 표 및 그래프 포함.
- 보고서가 지정 형식을 충족(요약, 본문, 결론, 부록).
- 추후 액션 아이템 및 일정 제시.

## Success Criteria
- ? 전수 감사 결과가 코드 경로와 수치와 함께 문서화됨.
- ? 5인 동시 접속 핵심 위험이 식별되고 우선순위가 매겨짐.
- ? 재현/검증 절차 및 모니터링 지표가 정의됨.
- ? 이해관계자용 보고서가 완성되어 공유됨.
- ? 단기/중장기 개선 백로그가 명확하게 정리됨.

## Timeline Estimates
- **Phase 1**: 2025-10-22 ~ 2025-10-23 (6h 실작업)
- **Phase 2**: 2025-10-23 ~ 2025-10-27 (16h 실작업)
- **Phase 3**: 2025-10-27 ~ 2025-10-29 (10h 실작업)

**Total**: 32h (약 4 작업일)

- **Kickoff**: 2025-10-22 10:00 KST
- **중간 점검**: 2025-10-24 11:00 KST
- **Phase 2 완료**: 2025-10-27 18:00 KST
- **최종 보고서 제출**: 2025-10-29 15:00 KST

## Risk Assessment
| Risk | Impact | Mitigation |
|------|--------|------------|
| 코드베이스 규모가 커서 누락 발생 | High | 체크리스트 기반 전수 검토, 자동 스캔 도구 병행 |
| 실제 부하 테스트 제한 | Medium | 로그 기반 추정, 스테이징 시뮬레이션, 추후 실제 부하 계획 제안 |
| 문서/구성 불일치 | Medium | 코드와 문서 교차 검증, 운영팀 인터뷰 요청 |
| 개선안 복잡도 높음 | Medium | 단기/중장기 단계적 로드맵 제시 |

## Dependencies
- 소스 전 영역 접근 권한
- DB/서비스 구성 정보, 환경 변수 샘플
- 기존 모니터링/로그 수집 경로
- QA/운영 팀과의 커뮤니케이션 채널

## Stakeholders
- **Product Owner**: 다중 사용자 지원 수준 확인
- **Engineering Leads (Backend/Frontend)**: 개선 우선순위 확정
- **QA/Operations Team**: 재현, 모니터링, 운영 대응 체계 정립
- **Security/IT Governance**: 동시성 관련 리스크 관리

## Related Documents
- [.claude/WORKFLOW_DIRECTIVES.md](../../.claude/WORKFLOW_DIRECTIVES.md)
- [REPORT_2025-10-22_canvas-auth-routing.md](REPORT_2025-10-22_canvas-auth-routing.md)
- [CHECKLIST_2025-10-22_routing-auth-token-stabilization.md](CHECKLIST_2025-10-22_routing-auth-token-stabilization.md)
- [PRD_2025-10-22_routing-db-auth-qa.md](PRD_2025-10-22_routing-db-auth-qa.md)

