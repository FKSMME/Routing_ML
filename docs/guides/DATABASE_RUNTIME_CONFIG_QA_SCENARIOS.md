# Database Runtime Configuration - QA 테스트 시나리오

**문서 ID:** QA-DB-CONFIG-2025-10-15
**버전:** 1.0.0
**작성일:** 2025-10-15 10:00:00
**작성자:** Claude (AI Assistant)
**대상 독자:** QA 엔지니어, 테스터

---

## 목차
1. [테스트 환경 준비](#1-테스트-환경-준비)
2. [기능 테스트 시나리오](#2-기능-테스트-시나리오)
3. [에러 처리 테스트](#3-에러-처리-테스트)
4. [보안 테스트](#4-보안-테스트)
5. [성능 테스트](#5-성능-테스트)
6. [통합 테스트](#6-통합-테스트)
7. [회귀 테스트](#7-회귀-테스트)

---

## 1. 테스트 환경 준비

### 1.1 사전 조건
- [ ] 백엔드 서버 실행 중 (포트 8000)
- [ ] 프런트엔드 서버 실행 중 (포트 3000 또는 5173)
- [ ] MSSQL 서버 접속 가능
- [ ] 테스트용 DB 계정 준비 (읽기/쓰기 권한)
- [ ] 테스트용 뷰 생성 (예: `dbo.BI_ITEM_INFO_VIEW_TEST`)

### 1.2 테스트 데이터 준비
```sql
-- MSSQL 서버에서 실행
USE KsmErp;

-- 테스트용 뷰 생성 (기존 뷰 복사)
CREATE VIEW dbo.BI_ITEM_INFO_VIEW_TEST AS
SELECT TOP 100 * FROM dbo.BI_ITEM_INFO_VIEW;

CREATE VIEW dbo.BI_ROUTING_HIS_VIEW_TEST AS
SELECT TOP 100 * FROM dbo.BI_ROUTING_HIS_VIEW;
```

### 1.3 초기 설정 백업
```bash
# workflow_settings.json 백업
cp config/workflow_settings.json config/workflow_settings.backup_qa.json
```

---

## 2. 기능 테스트 시나리오

### 2.1 설정 조회 (GET /api/database/config)

#### 테스트 케이스 1: 초기 로드
**목적:** 기본 설정이 올바르게 로드되는지 확인

**절차:**
1. 브라우저에서 Database Settings 화면 접속
2. 화면이 로드될 때까지 대기

**예상 결과:**
- ✅ 서버 주소, 데이터베이스명, 사용자명이 표시됨
- ✅ 뷰 이름 필드가 기본값으로 채워짐:
  - Item View: `dbo.BI_ITEM_INFO_VIEW`
  - Routing View: `dbo.BI_ROUTING_HIS_VIEW`
  - Work Result View: `dbo.BI_WORK_ORDER_RESULTS`
  - Purchase Order View: `dbo.BI_PUR_PO_VIEW`
- ✅ 비밀번호 저장 상태 표시

---

### 2.2 연결 테스트 (POST /api/database/test-connection)

#### 테스트 케이스 2: 정상 연결 테스트
**목적:** 올바른 설정으로 연결 테스트 성공

**절차:**
1. 서버 주소: `K3-DB.ksm.co.kr,1433`
2. 데이터베이스명: `KsmErp`
3. 사용자명: `FKSM_BI`
4. 비밀번호: (올바른 비밀번호 입력)
5. Encrypt: 체크 해제
6. Trust Certificate: 체크
7. "연결 테스트" 버튼 클릭

**예상 결과:**
- ✅ 녹색 성공 메시지 표시
- ✅ 메시지: "연결이 성공적으로 테스트되었습니다."
- ✅ 서버명 표시: `K3-DB` 또는 실제 서버명
- ✅ 데이터베이스명 표시: `KsmErp`
- ✅ 뷰 접근 테스트 결과 표시:
  - ✅ item_view
  - ✅ routing_view
  - ✅ work_result_view
  - ✅ purchase_order_view

#### 테스트 케이스 3: 잘못된 비밀번호
**목적:** 잘못된 비밀번호로 연결 테스트 실패

**절차:**
1. 비밀번호: `wrong_password`
2. "연결 테스트" 버튼 클릭

**예상 결과:**
- ❌ 빨간색 에러 메시지 표시
- ❌ 메시지: "연결 실패: Login failed for user ..." 또는 유사한 에러
- ⚠️ 사용자가 비밀번호를 다시 입력할 수 있도록 입력창 유지

#### 테스트 케이스 4: 잘못된 뷰 이름
**목적:** 존재하지 않는 뷰 이름으로 테스트 시 뷰 접근 실패 표시

**절차:**
1. Item View: `dbo.NON_EXISTENT_VIEW`
2. 다른 필드는 정상 값
3. "연결 테스트" 버튼 클릭

**예상 결과:**
- ✅ 연결은 성공 (초록색 박스)
- ❌ 뷰 접근 테스트 결과:
  - ❌ item_view (빨간색 X)
  - ✅ routing_view
  - ✅ work_result_view
  - ✅ purchase_order_view

---

### 2.3 설정 저장 (POST /api/database/config)

#### 테스트 케이스 5: 정상 저장
**목적:** 설정이 올바르게 저장되는지 확인

**절차:**
1. 모든 필드 입력 (정상 값)
2. "설정 저장" 버튼 클릭
3. 확인 대화상자에서 "확인" 클릭

**예상 결과:**
- ✅ 성공 메시지: "설정이 저장되었습니다. 즉시 반영됩니다."
- ✅ 비밀번호 입력창이 초기화됨
- ✅ 현재 연결 상태가 "연결됨"으로 변경
- ✅ `config/workflow_settings.json` 파일이 업데이트됨

**검증:**
```bash
# 파일 내용 확인
cat config/workflow_settings.json | grep -A 15 "data_source"
```

#### 테스트 케이스 6: 비밀번호 변경
**목적:** 비밀번호만 변경하고 저장

**절차:**
1. 기존 설정 로드 (비밀번호 저장되어 있음)
2. 새 비밀번호 입력: `new_password_123`
3. "설정 저장" 버튼 클릭

**예상 결과:**
- ✅ 설정 저장 성공
- ✅ 다음 연결 테스트 시 새 비밀번호로 인증됨

#### 테스트 케이스 7: 뷰 이름 변경 (런타임 반영 확인)
**목적:** 뷰 이름 변경 후 즉시 반영 확인

**절차:**
1. Item View를 `dbo.BI_ITEM_INFO_VIEW_TEST`로 변경
2. "설정 저장" 버튼 클릭
3. 품목 조회 API 호출 (별도 테스트 도구 또는 Postman 사용)
   ```bash
   curl http://localhost:8000/api/items/ITEM-001
   ```

**예상 결과:**
- ✅ 설정 저장 성공
- ✅ 품목 조회 시 `dbo.BI_ITEM_INFO_VIEW_TEST` 뷰 사용 확인
  - 로그에서 SQL 쿼리 확인: `SELECT ... FROM dbo.BI_ITEM_INFO_VIEW_TEST ...`
- ✅ **재시작 없이** 즉시 반영됨

---

### 2.4 데이터베이스 정보 조회 (GET /api/database/info)

#### 테스트 케이스 8: DB 정보 조회
**목적:** 현재 데이터베이스 정보가 올바르게 표시되는지 확인

**절차:**
1. Database Settings 화면 로드
2. 상단 "현재 연결 상태" 박스 확인
3. "새로고침" 버튼 클릭

**예상 결과:**
- ✅ 연결 상태: "연결됨" (녹색)
- ✅ 서버명 표시
- ✅ 데이터베이스명 표시
- ✅ 데이터베이스 크기 표시 (MB)
- ✅ 새로고침 시 최신 정보로 업데이트

---

## 3. 에러 처리 테스트

### 3.1 입력 Validation

#### 테스트 케이스 9: 필수 필드 누락
**목적:** 필수 필드 누락 시 에러 처리

**절차:**
1. 서버 주소 입력창을 비움
2. "연결 테스트" 또는 "설정 저장" 버튼 클릭

**예상 결과:**
- ⚠️ 버튼이 비활성화됨 (disabled 상태)
- ⚠️ 또는 에러 메시지: "서버 주소를 입력해주세요"

#### 테스트 케이스 10: SQL 인젝션 방지
**목적:** 뷰 이름에 SQL 인젝션 시도 시 차단

**절차:**
1. Item View: `dbo.BI_ITEM_INFO_VIEW'; DROP TABLE users; --`
2. "연결 테스트" 버튼 클릭

**예상 결과:**
- ❌ 에러 메시지: "item_view에 허용되지 않은 문자가 포함되어 있습니다."
- ❌ HTTP 422 응답

#### 테스트 케이스 11: 뷰 이름 길이 제한
**목적:** 128자 이상 뷰 이름 차단

**절차:**
1. Item View: `dbo.BI_ITEM_INFO_VIEW_VERY_LONG_NAME_...` (129자)
2. "연결 테스트" 버튼 클릭

**예상 결과:**
- ❌ 에러 메시지: "허용되지 않은 문자 ..." 또는 "너무 긴 이름"

---

### 3.2 네트워크 에러

#### 테스트 케이스 12: 백엔드 서버 중단
**목적:** 백엔드 서버 중단 시 에러 처리

**절차:**
1. 백엔드 서버 중지 (`Ctrl+C`)
2. "연결 테스트" 버튼 클릭

**예상 결과:**
- ❌ 에러 메시지: "연결 테스트 중 오류 발생: Failed to fetch" 또는 유사한 네트워크 에러
- ⚠️ 사용자에게 "서버에 연결할 수 없습니다" 안내

---

## 4. 보안 테스트

### 4.1 비밀번호 보안

#### 테스트 케이스 13: 비밀번호 마스킹
**목적:** 비밀번호 입력 시 마스킹 처리

**절차:**
1. 비밀번호 입력창에 `test123` 입력

**예상 결과:**
- ✅ 화면에 `•••••••` 로 표시됨
- ✅ 브라우저 개발자 도구 > Elements에서도 `type="password"` 확인

#### 테스트 케이스 14: workflow_settings.json 파일 권한
**목적:** 설정 파일 접근 권한 확인

**절차:**
1. 설정 저장 후 파일 권한 확인
   ```bash
   ls -l config/workflow_settings.json
   # Windows: icacls config\workflow_settings.json
   ```

**예상 결과:**
- ✅ 파일 권한: `600` (소유자만 읽기/쓰기) 또는 최소 권한
- ⚠️ 다른 사용자가 읽기 불가능

#### 테스트 케이스 15: 로그 마스킹
**목적:** 로그에 비밀번호가 평문으로 출력되지 않는지 확인

**절차:**
1. 설정 저장 후 백엔드 로그 확인
   ```bash
   tail -f logs/backend.log | grep -i password
   ```

**예상 결과:**
- ✅ 로그에 비밀번호가 `****`로 마스킹됨
- ❌ 평문 비밀번호 출력 없음

---

## 5. 성능 테스트

### 5.1 연결 테스트 속도

#### 테스트 케이스 16: 연결 테스트 응답 시간
**목적:** 연결 테스트가 합리적인 시간 내에 완료되는지 확인

**절차:**
1. 정상 설정으로 "연결 테스트" 버튼 클릭
2. 응답 시간 측정 (브라우저 개발자 도구 > Network 탭)

**예상 결과:**
- ✅ 응답 시간: < 3초 (로컬 네트워크)
- ✅ 응답 시간: < 10초 (원격 서버)

### 5.2 설정 저장 속도

#### 테스트 케이스 17: 설정 저장 응답 시간
**목적:** 설정 저장이 빠르게 완료되는지 확인

**절차:**
1. "설정 저장" 버튼 클릭
2. 응답 시간 측정

**예상 결과:**
- ✅ 응답 시간: < 1초
- ✅ 파일 쓰기 완료

---

## 6. 통합 테스트

### 6.1 전체 플로우 테스트

#### 테스트 케이스 18: 신규 설정 저장 → 연결 테스트 → 품목 조회
**목적:** 설정 변경 후 전체 시스템이 정상 작동하는지 확인

**절차:**
1. **Step 1:** 설정 변경
   - Item View: `dbo.BI_ITEM_INFO_VIEW_TEST`
   - "설정 저장" 클릭
2. **Step 2:** 연결 테스트
   - "연결 테스트" 클릭 → 성공 확인
3. **Step 3:** 품목 조회
   - Postman 또는 curl로 품목 조회 API 호출
     ```bash
     curl http://localhost:8000/api/items/ITEM-001
     ```
4. **Step 4:** 품목 목록 조회
   ```bash
   curl http://localhost:8000/api/items?limit=10
   ```

**예상 결과:**
- ✅ 모든 단계 성공
- ✅ 품목 조회 시 `dbo.BI_ITEM_INFO_VIEW_TEST` 뷰 사용
- ✅ 데이터 정상 반환

---

### 6.2 마이그레이션 시나리오

#### 테스트 케이스 19: .env → config_store 마이그레이션
**목적:** 기존 .env 설정이 config_store로 마이그레이션되는지 확인

**절차:**
1. `.env` 파일에 MSSQL 설정 추가
   ```
   MSSQL_SERVER=test-server.com,1433
   MSSQL_DATABASE=TestDB
   MSSQL_USER=test_user
   MSSQL_PASSWORD=test_pass
   MSSQL_ITEM_VIEW=dbo.TEST_ITEM_VIEW
   ```
2. 마이그레이션 스크립트 실행
   ```bash
   python scripts/migrate_database_config.py
   ```
3. `config/workflow_settings.json` 확인

**예상 결과:**
- ✅ `data_source` 섹션에 MSSQL 설정 추가됨
- ✅ 뷰 이름이 올바르게 반영됨
- ✅ 백업 파일 생성됨

---

## 7. 회귀 테스트

### 7.1 기존 기능 정상 작동 확인

#### 테스트 케이스 20: 품목 조회 API (변경 전 기본값)
**목적:** 설정 변경 후에도 기본 품목 조회 API가 정상 작동하는지 확인

**절차:**
1. 뷰 이름을 기본값으로 복원
2. 품목 조회 API 호출
   ```bash
   curl http://localhost:8000/api/items/ITEM-001
   ```

**예상 결과:**
- ✅ 200 OK 응답
- ✅ 품목 데이터 정상 반환

#### 테스트 케이스 21: 라우팅 생성 API
**목적:** 라우팅 생성 기능이 정상 작동하는지 확인

**절차:**
1. 라우팅 생성 API 호출
   ```bash
   curl -X POST http://localhost:8000/api/routing/generate \
     -H "Content-Type: application/json" \
     -d '{"item_cd": "ITEM-001", "quantity": 100}'
   ```

**예상 결과:**
- ✅ 라우팅 정상 생성
- ✅ Routing View에서 데이터 조회됨

---

## 8. 체크리스트

### 8.1 기능 테스트
- [ ] 설정 조회 (초기 로드)
- [ ] 연결 테스트 (정상)
- [ ] 연결 테스트 (잘못된 비밀번호)
- [ ] 연결 테스트 (잘못된 뷰 이름)
- [ ] 설정 저장 (정상)
- [ ] 설정 저장 (비밀번호 변경)
- [ ] 뷰 이름 변경 (런타임 반영)
- [ ] DB 정보 조회

### 8.2 에러 처리
- [ ] 필수 필드 누락
- [ ] SQL 인젝션 방지
- [ ] 뷰 이름 길이 제한
- [ ] 백엔드 서버 중단

### 8.3 보안
- [ ] 비밀번호 마스킹
- [ ] 파일 권한 확인
- [ ] 로그 마스킹

### 8.4 성능
- [ ] 연결 테스트 속도
- [ ] 설정 저장 속도

### 8.5 통합
- [ ] 전체 플로우 테스트
- [ ] 마이그레이션 시나리오

### 8.6 회귀
- [ ] 품목 조회 API
- [ ] 라우팅 생성 API

---

## 9. 이슈 리포트 템플릿

### 이슈 발견 시 기록 형식
```
**이슈 ID:** QA-DB-001
**테스트 케이스:** TC-05 (정상 저장)
**심각도:** High / Medium / Low
**재현 절차:**
1. ...
2. ...

**예상 결과:**
...

**실제 결과:**
...

**스크린샷:**
(첨부)

**환경 정보:**
- OS: Windows 10 / Ubuntu 22.04
- 브라우저: Chrome 120
- 백엔드 버전: v1.0.0
- MSSQL 버전: 2019

**추가 노트:**
...
```

---

## 10. 테스트 완료 보고서

### 보고서 작성 시 포함 항목
1. **테스트 개요**
   - 테스트 일시
   - 테스터 이름
   - 테스트 환경

2. **테스트 결과 요약**
   - 총 테스트 케이스 수: 21개
   - 통과: X개
   - 실패: X개
   - 보류: X개

3. **주요 이슈**
   - 심각도 High 이슈 목록
   - 심각도 Medium 이슈 목록

4. **권장 사항**
   - 릴리즈 승인 여부
   - 추가 테스트 필요 여부

---

**문서 버전:** 1.0.0
**최종 업데이트:** 2025-10-15 10:00:00
