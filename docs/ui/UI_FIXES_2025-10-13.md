# UI 수정 작업 보고서

**작성일**: 2025년 10월 13일
**작업자**: Claude Code
**작업 시간**: 15:20 - 16:00 (약 40분)

## 작업 개요

Routing ML v4 프로젝트의 3가지 UI 이슈를 수정하였습니다:
1. 라우팅 생성의 시각화 가로 스크롤 제거
2. 후보 공정 블록 안의 글자와 UX 위치 조정
3. 알고리즘 코드 파일별 레인보우 로딩 연결

---

## 1. 라우팅 생성의 시각화 가로 스크롤 제거

### 문제 상황
- 라우팅 타임라인 시각화 영역에서 불필요한 가로 스크롤이 발생
- 사용자 경험 저해 및 시각적 불편함 야기

### 수정 내용
**파일**: `frontend-prediction/src/index.css`
**라인**: 3748-3749

**변경 전**:
```css
.timeline-flow {
  height: 260px;
  border: 1px solid var(--border);
  border-radius: 1rem;
  background: color-mix(in oklch, var(--surface-card) 94%, transparent);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
  overflow: auto;  /* 이전: 양방향 스크롤 허용 */
  position: relative;
}
```

**변경 후**:
```css
.timeline-flow {
  height: 260px;
  border: 1px solid var(--border);
  border-radius: 1rem;
  background: color-mix(in oklch, var(--surface-card) 94%, transparent);
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
  overflow-x: hidden;  /* 신규: 가로 스크롤 비활성화 */
  overflow-y: auto;    /* 신규: 세로 스크롤만 허용 */
  position: relative;
}
```

### 효과
- ✅ 가로 스크롤 완전 제거
- ✅ 세로 스크롤은 필요 시 작동
- ✅ 더 깔끔한 UI/UX

---

## 2. 후보 공정 블록 안의 글자와 UX 위치 조정

### 문제 상황
- 후보 공정 카드 내부의 텍스트와 UI 요소들이 정렬되지 않음
- 헤더의 코드와 시퀀스 번호 간격이 일관되지 않음
- 메타 정보(세팅/가공/대기 시간) 레이아웃이 어색함
- 액션 버튼 정렬이 중앙에 맞지 않음

### 수정 내용

#### 2.1 헤더 영역 수정
**파일**: `frontend-prediction/src/index.css`
**라인**: 2326-2343

**변경 전**:
```css
.candidate-block__header {
  display: flex;
  align-items: center;
  justify-content: space-between;  /* space-between으로 양쪽 끝 배치 */
  margin-bottom: 0.35rem;
}

.candidate-block__code {
  font-weight: 600;
  color: var(--text-heading);
}

.candidate-block__seq {
  font-size: 0.75rem;
  color: var(--text-muted);
}
```

**변경 후**:
```css
.candidate-block__header {
  display: flex;
  align-items: center;
  gap: 0.5rem;              /* 요소 간 간격 명시 */
  margin-bottom: 0.5rem;    /* 하단 마진 증가 */
}

.candidate-block__code {
  font-weight: 600;
  color: var(--text-heading);
  font-size: 0.9rem;        /* 폰트 크기 명시 */
}

.candidate-block__seq {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-left: auto;        /* 자동으로 우측 정렬 */
}
```

#### 2.2 설명 텍스트 수정
**라인**: 2345-2350

**변경 전**:
```css
.candidate-block__desc {
  font-size: 0.82rem;
  color: var(--text-primary);
  margin-bottom: 0.35rem;
}
```

**변경 후**:
```css
.candidate-block__desc {
  font-size: 0.82rem;
  color: var(--text-primary);
  margin-bottom: 0.6rem;     /* 하단 마진 증가 */
  line-height: 1.4;          /* 줄 간격 추가 */
}
```

#### 2.3 메타 정보 레이아웃 수정
**라인**: 2352-2360

**변경 전**:
```css
.candidate-block__meta {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 0.4rem;
  font-size: 0.75rem;
  color: var(--text-muted);
}
```

**변경 후**:
```css
.candidate-block__meta {
  display: flex;                    /* grid에서 flex로 변경 */
  align-items: center;              /* 수직 중앙 정렬 */
  justify-content: space-between;   /* 균등 배분 */
  gap: 0.5rem;                      /* 간격 증가 */
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-bottom: 0.2rem;            /* 하단 마진 추가 */
}
```

#### 2.4 액션 버튼 영역 수정
**라인**: 2374-2419

**변경 전**:
```css
.candidate-block__actions {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.75rem;
  padding-top: 0.75rem;
  border-top: 1px solid var(--border-light);
}

.candidate-block__action {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.4rem 0.75rem;
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--text-primary);
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s ease;
}

.candidate-block__hint {
  margin-top: 0.45rem;
  font-size: 0.7rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}
```

**변경 후**:
```css
.candidate-block__actions {
  display: flex;
  align-items: center;              /* 수직 중앙 정렬 추가 */
  gap: 0.5rem;
  margin-top: 0.75rem;
  padding-top: 0.75rem;
  border-top: 1px solid var(--border-light);
}

.candidate-block__action {
  display: inline-flex;             /* flex에서 inline-flex로 변경 */
  align-items: center;
  justify-content: center;          /* 수평 중앙 정렬 추가 */
  gap: 0.35rem;
  padding: 0.5rem 0.85rem;          /* 패딩 조정 */
  font-size: 0.75rem;
  font-weight: 500;
  color: var(--text-primary);
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;              /* 텍스트 줄바꿈 방지 */
}

.candidate-block__hint {
  margin-top: 0.5rem;               /* 상단 마진 조정 */
  font-size: 0.7rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  text-align: center;               /* 중앙 정렬 추가 */
}
```

### 효과
- ✅ 헤더의 코드와 시퀀스 번호가 적절한 간격으로 배치
- ✅ 메타 정보(시간) 요소들이 균등하게 배분
- ✅ 액션 버튼들이 중앙 정렬되어 시각적 일관성 확보
- ✅ 힌트 텍스트가 중앙 정렬되어 가독성 향상
- ✅ 전체적인 카드 레이아웃의 시각적 균형 개선

---

## 3. 알고리즘 코드 파일별 레인보우 로딩 연결

### 문제 상황
- Training 워크스페이스의 알고리즘 시각화에서 Rainbow 모드 사용 시
- `trainer_ml.py` 파일만 플로우차트가 표시됨
- 나머지 5개 파일(`training_service.py`, `predictor_ml.py`, `prediction_service.py`, `database.py`, `feature_weights.py`)은 플로우차트가 표시되지 않음

### 원인 분석
**파일**: `frontend-training/src/components/workspaces/AlgorithmVisualizationWorkspace.tsx`

1. **FLOW_LIBRARY 객체 구조 문제**:
   - `trainer_ml.py`는 파일명으로 키가 정의됨
   - 나머지 파일들은 숫자 ID('1', '2', '3', '4', '5', '6')로만 정의됨

2. **displayedFiles 배열 구조**:
   ```typescript
   {
     id: 'trainer_ml',           // 파일 ID
     name: 'trainer_ml.py',      // 파일명
     path: 'backend/trainer_ml.py',
     // ...
   }
   ```

3. **flowDefinition 매칭 로직** (550-555라인):
   ```typescript
   const flowDefinition = useMemo(() => {
     if (!selectedFile) return undefined;
     // 파일명 또는 ID로 매칭 시도
     return FLOW_LIBRARY[selectedFile.name] || FLOW_LIBRARY[selectedFile.id] || undefined;
   }, [selectedFile]);
   ```

4. **문제점**:
   - `training_service.py` 선택 시 → `selectedFile.id = 'training_service'`
   - `FLOW_LIBRARY['training_service']` 존재하지 않음 (숫자 키만 존재)
   - 매칭 실패 → 플로우차트 미표시

### 수정 내용

#### FLOW_LIBRARY 키 추가 및 플로우 정의

**파일**: `frontend-training/src/components/workspaces/AlgorithmVisualizationWorkspace.tsx`
**라인**: 128-253

**변경 전**:
```typescript
const FLOW_LIBRARY: Record<string, FileFlowDefinition> = {
  'trainer_ml.py': { /* ... */ },
  '1': { /* ... */ },  // 어떤 파일인지 불명확
  '2': { /* ... */ },
  '3': { /* ... */ },
  '4': { /* ... */ },
  '5': { /* ... */ },
  '6': { /* ... */ },
};
```

**변경 후**:
```typescript
const FLOW_LIBRARY: Record<string, FileFlowDefinition> = {
  // 1. trainer_ml.py - 모델 학습 파이프라인
  'trainer_ml.py': {
    summary: 'Raw 생산 데이터를 전처리하고 신규 라우팅 모델을 학습합니다.',
    steps: [
      { id: 'data-ingest', label: '데이터 수집', /* ... */ },
      { id: 'feature-build', label: '피처 엔지니어링', /* ... */ },
      { id: 'normalize', label: '정규화', /* ... */ },
      { id: 'train', label: '모델 학습', /* ... */ },
      { id: 'export', label: '모델 아티팩트 저장', /* ... */ },
    ],
    edges: [ /* ... */ ],
  },
  'trainer_ml': {  // ID로도 매칭 가능하도록 추가
    /* trainer_ml.py와 동일한 내용 */
  },

  // 2. training_service.py - 학습 API 서비스
  'training_service': {
    summary: 'Training service API가 모델 학습 요청을 처리합니다.',
    steps: [
      { id: 'api-receive', label: 'API 요청 수신', /* ... */ },
      { id: 'validate', label: '파라미터 검증', /* ... */ },
      { id: 'call-trainer', label: 'Trainer 호출', /* ... */ },
      { id: 'monitor', label: '진행 상황 모니터링', /* ... */ },
      { id: 'response', label: 'API 응답', /* ... */ },
    ],
    edges: [
      { source: 'api-receive', target: 'validate' },
      { source: 'validate', target: 'call-trainer' },
      { source: 'call-trainer', target: 'monitor' },
      { source: 'monitor', target: 'response' },
    ],
  },

  // 3. predictor_ml.py - 실시간 예측 파이프라인
  'predictor_ml': {
    summary: '훈련된 모델을 불러와 실시간 라우팅을 예측합니다.',
    steps: [
      { id: 'load-model', label: '모델 로드', /* ... */ },
      { id: 'candidate-search', label: '후보 탐색', /* ... */ },
      { id: 'scoring', label: '스코어 계산', /* ... */ },
      { id: 'ranking', label: '상위 라우팅 선정', /* ... */ },
      { id: 'serialize', label: 'ERP 직렬화', /* ... */ },
    ],
    edges: [ /* ... */ ],
  },

  // 4. prediction_service.py - 예측 API 서비스
  'prediction_service': {
    summary: 'Prediction service API가 라우팅 예측 요청을 처리합니다.',
    steps: [
      { id: 'api-receive', label: 'API 요청 수신', /* ... */ },
      { id: 'parse-input', label: '입력 파싱', /* ... */ },
      { id: 'call-predictor', label: 'Predictor 호출', /* ... */ },
      { id: 'format-result', label: '결과 포맷팅', /* ... */ },
      { id: 'response', label: 'API 응답', /* ... */ },
    ],
    edges: [ /* ... */ ],
  },

  // 5. database.py - 데이터베이스 관리
  'database': {
    summary: 'MSSQL 데이터베이스 연결과 CRUD 작업을 관리합니다.',
    steps: [
      { id: 'connect', label: 'DB 연결 풀', /* ... */ },
      { id: 'query', label: '쿼리 실행', /* ... */ },
      { id: 'transaction', label: '트랜잭션 관리', /* ... */ },
      { id: 'result', label: '결과 반환', /* ... */ },
    ],
    edges: [
      { source: 'connect', target: 'query' },
      { source: 'connect', target: 'transaction' },
      { source: 'query', target: 'result' },
      { source: 'transaction', target: 'result' },
    ],
  },

  // 6. feature_weights.py - 피처 가중치 관리
  'feature_weights': {
    summary: '피처 가중치를 계산하고 저장하는 유틸리티입니다.',
    steps: [
      { id: 'load-history', label: '이력 로드', /* ... */ },
      { id: 'calculate', label: '가중치 계산', /* ... */ },
      { id: 'normalize', label: '정규화', /* ... */ },
      { id: 'save', label: '저장', /* ... */ },
    ],
    edges: [
      { source: 'load-history', target: 'calculate' },
      { source: 'calculate', target: 'normalize' },
      { source: 'normalize', target: 'save' },
    ],
  },
};
```

### 각 파일별 플로우 요약

#### 1. trainer_ml.py
- **목적**: 모델 학습 파이프라인
- **단계**: 데이터 수집 → 피처 엔지니어링 → 정규화 → 모델 학습 → 아티팩트 저장
- **특징**: LightGBM 기반 학습, S3/로컬 저장

#### 2. training_service.py
- **목적**: FastAPI 학습 요청 처리
- **단계**: API 수신 → 파라미터 검증 → Trainer 호출 → 모니터링 → 응답
- **특징**: 비동기 호출, 진행률 추적

#### 3. predictor_ml.py
- **목적**: 실시간 라우팅 예측
- **단계**: 모델 로드 → 후보 탐색 → 스코어 계산 → 랭킹 → ERP 직렬화
- **특징**: Faiss/HNSW 사용, Top-K 선정

#### 4. prediction_service.py
- **목적**: FastAPI 예측 요청 처리
- **단계**: API 수신 → 입력 파싱 → Predictor 호출 → 결과 포맷팅 → 응답
- **특징**: ERP 인터페이스 형식 변환

#### 5. database.py
- **목적**: MSSQL 데이터베이스 관리
- **단계**: 연결 풀 → 쿼리 실행/트랜잭션 → 결과 반환
- **특징**: SQLAlchemy 기반, ACID 트랜잭션

#### 6. feature_weights.py
- **목적**: 피처 가중치 계산 및 저장
- **단계**: 이력 로드 → 가중치 계산 → 정규화 → 저장
- **특징**: SHAP/LIME 기반, JSON/DB 저장

### 효과
- ✅ 6개 모든 Python 파일에 대해 Rainbow 플로우차트 표시
- ✅ 각 파일의 역할과 처리 흐름을 시각적으로 명확하게 표현
- ✅ 파일명과 ID 양쪽으로 매칭 가능하여 호환성 향상
- ✅ 개발자 경험(DX) 개선 - 코드 흐름 이해 용이

---

## 작업 완료 현황

### 수정된 파일 목록
1. `frontend-prediction/src/index.css` (라우팅 시각화, 후보 공정 블록)
2. `frontend-training/src/components/workspaces/AlgorithmVisualizationWorkspace.tsx` (알고리즘 레인보우)

### 테스트 항목
- [ ] 라우팅 타임라인에서 가로 스크롤이 발생하지 않는지 확인
- [ ] 후보 공정 카드의 텍스트와 버튼이 적절하게 정렬되었는지 확인
- [ ] Training 워크스페이스에서 6개 모든 파일의 Rainbow 플로우차트가 표시되는지 확인

### 다음 단계
1. 변경 사항 커밋 및 푸시
2. 메인 브랜치에 머지
3. 프로덕션 배포 전 QA 테스트

---

## 기술적 세부사항

### CSS 변경 요약
| 클래스명 | 변경 속성 | 목적 |
|---------|---------|------|
| `.timeline-flow` | `overflow: auto` → `overflow-x: hidden; overflow-y: auto` | 가로 스크롤 제거 |
| `.candidate-block__header` | `justify-content: space-between` → `gap: 0.5rem` | 일관된 간격 |
| `.candidate-block__seq` | 추가: `margin-left: auto` | 우측 자동 정렬 |
| `.candidate-block__desc` | `line-height: 1.4` 추가 | 가독성 향상 |
| `.candidate-block__meta` | `grid` → `flex` + `justify-content: space-between` | 균등 배분 |
| `.candidate-block__action` | `display: flex` → `inline-flex` + `white-space: nowrap` | 버튼 중앙 정렬 |
| `.candidate-block__hint` | `text-align: center` 추가 | 힌트 중앙 정렬 |

### TypeScript 변경 요약
| 항목 | 변경 내용 | 영향 범위 |
|-----|----------|---------|
| FLOW_LIBRARY | 6개 파일에 대한 플로우 정의 추가 | AlgorithmVisualizationWorkspace |
| 파일 ID 매칭 | 파일명과 ID 모두로 매칭 가능 | Rainbow 모드 전체 |

---

## 참고 자료

### 관련 이슈
- UI Issue #1: 라우팅 시각화 가로 스크롤
- UI Issue #2: 후보 공정 블록 정렬
- UI Issue #3: 알고리즘 레인보우 로딩

### 관련 커밋
- 다음 커밋에서 생성 예정

### 스크린샷
- 실제 화면 캡처는 사용자 테스트 후 추가 예정

---

**작성 완료**: 2025-10-13 16:00
**문서 버전**: 1.0
